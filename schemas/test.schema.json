{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Schema for IntelliTester test definition files",
  "type": "object",
  "properties": {
    "name": {
      "description": "The name of the test",
      "type": "string",
      "minLength": 1
    },
    "platform": {
      "description": "The platform to run the test on",
      "type": "string",
      "enum": [
        "web",
        "android",
        "ios"
      ]
    },
    "variables": {
      "description": "Variables that can be referenced in test steps using ${VARIABLE_NAME} syntax",
      "type": "object",
      "propertyNames": {
        "type": "string"
      },
      "additionalProperties": {
        "type": "string"
      }
    },
    "config": {
      "description": "Test-specific configuration that overrides global settings",
      "type": "object",
      "properties": {
        "defaults": {
          "description": "Default settings that apply to all tests unless overridden",
          "type": "object",
          "properties": {
            "timeout": {
              "description": "Default timeout in milliseconds for all actions",
              "type": "integer",
              "exclusiveMinimum": 0,
              "maximum": 9007199254740991
            },
            "screenshots": {
              "description": "When to capture screenshots during test execution",
              "type": "string",
              "enum": [
                "on-failure",
                "always",
                "never"
              ]
            }
          },
          "additionalProperties": false
        },
        "web": {
          "description": "Web platform configuration",
          "type": "object",
          "properties": {
            "baseUrl": {
              "description": "Base URL for the web application",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            },
            "browser": {
              "description": "Browser to use for testing",
              "type": "string"
            },
            "headless": {
              "description": "Run browser in headless mode",
              "type": "boolean"
            },
            "timeout": {
              "description": "Timeout in milliseconds for web actions",
              "type": "integer",
              "exclusiveMinimum": 0,
              "maximum": 9007199254740991
            }
          },
          "additionalProperties": false
        },
        "android": {
          "description": "Android platform configuration",
          "type": "object",
          "properties": {
            "appId": {
              "description": "Android application ID",
              "type": "string"
            },
            "device": {
              "description": "Device name or ID to run tests on",
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "ios": {
          "description": "iOS platform configuration",
          "type": "object",
          "properties": {
            "bundleId": {
              "description": "iOS bundle identifier",
              "type": "string"
            },
            "simulator": {
              "description": "Simulator name to run tests on",
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "email": {
          "description": "Email testing configuration",
          "type": "object",
          "properties": {
            "provider": {
              "description": "Email testing provider",
              "type": "string",
              "const": "inbucket"
            },
            "endpoint": {
              "description": "Email service endpoint URL",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            }
          },
          "required": [
            "provider"
          ],
          "additionalProperties": false
        },
        "appwrite": {
          "description": "Appwrite backend configuration",
          "type": "object",
          "properties": {
            "endpoint": {
              "description": "Appwrite API endpoint",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            },
            "projectId": {
              "description": "Appwrite project ID",
              "type": "string",
              "minLength": 1
            },
            "apiKey": {
              "description": "Appwrite API key with appropriate permissions",
              "type": "string",
              "minLength": 1
            },
            "cleanup": {
              "description": "Enable automatic cleanup of created resources",
              "type": "boolean"
            },
            "cleanupOnFailure": {
              "description": "Clean up resources even when test fails",
              "type": "boolean"
            }
          },
          "required": [
            "endpoint",
            "projectId",
            "apiKey"
          ],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "steps": {
      "description": "The sequence of actions to execute in this test",
      "minItems": 1,
      "type": "array",
      "items": {
        "oneOf": [
          {
            "description": "Navigate to a URL",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "navigate"
              },
              "value": {
                "description": "URL or path to navigate to",
                "type": "string",
                "minLength": 1
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "value"
            ],
            "additionalProperties": false
          },
          {
            "description": "Click or tap on an element",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "tap"
              },
              "target": {
                "type": "object",
                "properties": {
                  "description": {
                    "description": "AI-friendly description of the element to find",
                    "type": "string"
                  },
                  "testId": {
                    "description": "data-testid attribute value",
                    "type": "string"
                  },
                  "text": {
                    "description": "Visible text content",
                    "type": "string"
                  },
                  "css": {
                    "description": "CSS selector",
                    "type": "string"
                  },
                  "xpath": {
                    "description": "XPath selector",
                    "type": "string"
                  },
                  "role": {
                    "description": "ARIA role",
                    "type": "string"
                  },
                  "name": {
                    "description": "Accessible name",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "target"
            ],
            "additionalProperties": false
          },
          {
            "description": "Input text into a field",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "input"
              },
              "target": {
                "type": "object",
                "properties": {
                  "description": {
                    "description": "AI-friendly description of the element to find",
                    "type": "string"
                  },
                  "testId": {
                    "description": "data-testid attribute value",
                    "type": "string"
                  },
                  "text": {
                    "description": "Visible text content",
                    "type": "string"
                  },
                  "css": {
                    "description": "CSS selector",
                    "type": "string"
                  },
                  "xpath": {
                    "description": "XPath selector",
                    "type": "string"
                  },
                  "role": {
                    "description": "ARIA role",
                    "type": "string"
                  },
                  "name": {
                    "description": "Accessible name",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "value": {
                "description": "Text to input (can reference variables with ${VAR_NAME})",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "target",
              "value"
            ],
            "additionalProperties": false
          },
          {
            "description": "Assert that an element exists or contains expected text",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "assert"
              },
              "target": {
                "type": "object",
                "properties": {
                  "description": {
                    "description": "AI-friendly description of the element to find",
                    "type": "string"
                  },
                  "testId": {
                    "description": "data-testid attribute value",
                    "type": "string"
                  },
                  "text": {
                    "description": "Visible text content",
                    "type": "string"
                  },
                  "css": {
                    "description": "CSS selector",
                    "type": "string"
                  },
                  "xpath": {
                    "description": "XPath selector",
                    "type": "string"
                  },
                  "role": {
                    "description": "ARIA role",
                    "type": "string"
                  },
                  "name": {
                    "description": "Accessible name",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "value": {
                "description": "Expected text content",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "target"
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "wait"
              },
              "target": {
                "description": "Element to wait for",
                "type": "object",
                "properties": {
                  "description": {
                    "description": "AI-friendly description of the element to find",
                    "type": "string"
                  },
                  "testId": {
                    "description": "data-testid attribute value",
                    "type": "string"
                  },
                  "text": {
                    "description": "Visible text content",
                    "type": "string"
                  },
                  "css": {
                    "description": "CSS selector",
                    "type": "string"
                  },
                  "xpath": {
                    "description": "XPath selector",
                    "type": "string"
                  },
                  "role": {
                    "description": "ARIA role",
                    "type": "string"
                  },
                  "name": {
                    "description": "Accessible name",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "timeout": {
                "description": "Time to wait in milliseconds",
                "type": "integer",
                "exclusiveMinimum": 0,
                "maximum": 9007199254740991
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          },
          {
            "description": "Scroll the page or an element",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "scroll"
              },
              "target": {
                "description": "Element to scroll",
                "type": "object",
                "properties": {
                  "description": {
                    "description": "AI-friendly description of the element to find",
                    "type": "string"
                  },
                  "testId": {
                    "description": "data-testid attribute value",
                    "type": "string"
                  },
                  "text": {
                    "description": "Visible text content",
                    "type": "string"
                  },
                  "css": {
                    "description": "CSS selector",
                    "type": "string"
                  },
                  "xpath": {
                    "description": "XPath selector",
                    "type": "string"
                  },
                  "role": {
                    "description": "ARIA role",
                    "type": "string"
                  },
                  "name": {
                    "description": "Accessible name",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "direction": {
                "description": "Direction to scroll",
                "type": "string",
                "enum": [
                  "up",
                  "down"
                ]
              },
              "amount": {
                "description": "Amount to scroll in pixels",
                "type": "integer",
                "exclusiveMinimum": 0,
                "maximum": 9007199254740991
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          },
          {
            "description": "Take a screenshot",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "screenshot"
              },
              "name": {
                "description": "Name for the screenshot file",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          },
          {
            "description": "Set a variable for use in later steps",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "setVar"
              },
              "name": {
                "description": "Variable name to set",
                "type": "string",
                "minLength": 1
              },
              "value": {
                "description": "Static value to set",
                "type": "string"
              },
              "from": {
                "description": "Extract value from a source",
                "type": "string",
                "enum": [
                  "response",
                  "element",
                  "email"
                ]
              },
              "path": {
                "description": "JSON path or selector for extraction",
                "type": "string"
              },
              "pattern": {
                "description": "Regular expression pattern for extraction",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "name"
            ],
            "additionalProperties": false
          },
          {
            "description": "Wait for an email to arrive",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "email.waitFor"
              },
              "mailbox": {
                "description": "Email address or mailbox to check",
                "type": "string",
                "minLength": 1
              },
              "timeout": {
                "description": "How long to wait for email in milliseconds",
                "type": "integer",
                "exclusiveMinimum": 0,
                "maximum": 9007199254740991
              },
              "subjectContains": {
                "description": "Filter by email subject",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "mailbox"
            ],
            "additionalProperties": false
          },
          {
            "description": "Extract a verification code from email",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "email.extractCode"
              },
              "saveTo": {
                "description": "Variable name to save the extracted code",
                "type": "string",
                "minLength": 1
              },
              "pattern": {
                "description": "Regular expression to extract code",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "saveTo"
            ],
            "additionalProperties": false
          },
          {
            "description": "Extract a link from email",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "email.extractLink"
              },
              "saveTo": {
                "description": "Variable name to save the extracted link",
                "type": "string",
                "minLength": 1
              },
              "pattern": {
                "description": "Regular expression to match specific links",
                "type": "string"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "saveTo"
            ],
            "additionalProperties": false
          },
          {
            "description": "Clear emails from a mailbox",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "email.clear"
              },
              "mailbox": {
                "description": "Email address or mailbox to clear",
                "type": "string",
                "minLength": 1
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type",
              "mailbox"
            ],
            "additionalProperties": false
          },
          {
            "description": "Verify email using Appwrite",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "appwrite.verifyEmail"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          },
          {
            "description": "Pause execution and open Playwright Inspector for debugging",
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "const": "debug"
              },
              "track": {
                "type": "object",
                "description": "Optional tracking metadata for cleanup",
                "properties": {
                  "type": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource type"
                  },
                  "id": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Tracked resource ID"
                  },
                  "includeStepContext": {
                    "type": "boolean",
                    "description": "Include step context with tracked resource"
                  }
                },
                "required": [
                  "type",
                  "id"
                ],
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": false
          }
        ]
      }
    }
  },
  "required": [
    "name",
    "platform",
    "steps"
  ],
  "additionalProperties": false,
  "title": "IntelliTester Test Definition"
}