{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Schema for IntelliTester workflow files that orchestrate multiple tests",
  "type": "object",
  "properties": {
    "name": {
      "description": "The name of the workflow",
      "type": "string",
      "minLength": 1
    },
    "platform": {
      "description": "The platform to run the workflow on",
      "default": "web",
      "type": "string",
      "enum": [
        "web",
        "android",
        "ios"
      ]
    },
    "config": {
      "description": "Workflow-level configuration that applies to all tests",
      "type": "object",
      "properties": {
        "web": {
          "description": "Web platform configuration for the workflow",
          "type": "object",
          "properties": {
            "baseUrl": {
              "description": "Base URL for all tests in this workflow",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            },
            "browser": {
              "description": "Browser to use for all web tests",
              "type": "string",
              "enum": [
                "chromium",
                "firefox",
                "webkit"
              ]
            },
            "headless": {
              "description": "Run browser in headless mode",
              "type": "boolean"
            }
          },
          "additionalProperties": false
        },
        "appwrite": {
          "description": "Appwrite backend configuration for the workflow",
          "type": "object",
          "properties": {
            "endpoint": {
              "description": "Appwrite API endpoint",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            },
            "projectId": {
              "description": "Appwrite project ID",
              "type": "string",
              "minLength": 1
            },
            "apiKey": {
              "description": "Appwrite API key",
              "type": "string",
              "minLength": 1
            },
            "cleanup": {
              "description": "Enable automatic cleanup of created resources",
              "default": true,
              "type": "boolean"
            },
            "cleanupOnFailure": {
              "description": "Clean up resources even when tests fail",
              "default": true,
              "type": "boolean"
            }
          },
          "required": [
            "endpoint",
            "projectId",
            "apiKey",
            "cleanup",
            "cleanupOnFailure"
          ],
          "additionalProperties": false
        },
        "cleanup": {
          "description": "Resource cleanup configuration",
          "type": "object",
          "properties": {
            "provider": {
              "description": "Cleanup provider to use",
              "type": "string"
            },
            "parallel": {
              "description": "Run cleanup tasks in parallel",
              "default": false,
              "type": "boolean"
            },
            "retries": {
              "description": "Number of retry attempts for failed cleanup operations",
              "default": 3,
              "type": "number",
              "minimum": 1,
              "maximum": 10
            },
            "types": {
              "description": "Map resource types to cleanup handler methods",
              "type": "object",
              "propertyNames": {
                "type": "string"
              },
              "additionalProperties": {
                "type": "string"
              }
            },
            "handlers": {
              "description": "Explicit paths to custom cleanup handler files",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "discover": {
              "description": "Auto-discovery configuration for cleanup handlers",
              "type": "object",
              "properties": {
                "enabled": {
                  "description": "Enable auto-discovery of cleanup handlers",
                  "default": true,
                  "type": "boolean"
                },
                "paths": {
                  "description": "Directories to search for cleanup handlers",
                  "default": [
                    "./tests/cleanup"
                  ],
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "pattern": {
                  "description": "Glob pattern for handler files",
                  "default": "**/*.ts",
                  "type": "string"
                }
              },
              "required": [
                "enabled",
                "paths",
                "pattern"
              ],
              "additionalProperties": false
            },
            "scanUntracked": {
              "type": "boolean",
              "description": "Scan for untracked resources using provider heuristics"
            }
          },
          "required": [
            "parallel",
            "retries"
          ],
          "additionalProperties": {}
        },
        "webServer": {
          "description": "Configuration for starting a web server before tests",
          "type": "object",
          "properties": {
            "command": {
              "description": "Command to start the web server",
              "type": "string",
              "minLength": 1
            },
            "auto": {
              "description": "Auto-detect server start command from package.json",
              "type": "boolean"
            },
            "url": {
              "description": "URL to wait for before starting tests",
              "type": "string",
              "minLength": 1,
              "format": "uri"
            },
            "reuseExistingServer": {
              "description": "Use existing server if already running at the URL",
              "default": true,
              "type": "boolean"
            },
            "timeout": {
              "description": "Timeout in milliseconds to wait for server to start",
              "default": 30000,
              "type": "integer",
              "exclusiveMinimum": 0,
              "maximum": 9007199254740991
            }
          },
          "required": [
            "url",
            "reuseExistingServer",
            "timeout"
          ],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "continueOnFailure": {
      "description": "Continue running subsequent tests even if a test fails",
      "default": false,
      "type": "boolean"
    },
    "tests": {
      "description": "List of test files to execute in this workflow",
      "minItems": 1,
      "type": "array",
      "items": {
        "description": "Reference to a test file",
        "type": "object",
        "properties": {
          "file": {
            "description": "Path to the test file relative to the workflow file",
            "type": "string",
            "minLength": 1
          },
          "id": {
            "description": "Optional ID for referencing this test in variables or dependencies",
            "type": "string",
            "minLength": 1
          },
          "variables": {
            "description": "Variables to inject or override for this specific test",
            "type": "object",
            "propertyNames": {
              "type": "string"
            },
            "additionalProperties": {
              "type": "string"
            }
          }
        },
        "required": [
          "file"
        ],
        "additionalProperties": false
      }
    }
  },
  "required": [
    "name",
    "platform",
    "continueOnFailure",
    "tests"
  ],
  "additionalProperties": false,
  "title": "IntelliTester Workflow Definition"
}